<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Media Carousel with Rectangular Progress Bar</title>
<style>
  :root {
    --custom-media-width: 400px;
    --custom-media-height: 300px;
  }

  #custom-media-carousel-wrapper {
    width: var(--custom-media-width);
    height: var(--custom-media-height);
    margin: 20px auto;
    overflow: hidden;
    position: relative;
    user-select: none;
  }

  #custom-carousel-inner {
    display: flex;
    transition: transform 0.5s ease-in-out;
    height: 100%;
  }

  .custom-media-item {
    flex: 0 0 var(--custom-media-width);
    height: var(--custom-media-height);
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .custom-media-item img,
  .custom-media-item video {
    width: var(--custom-media-width);
    height: var(--custom-media-height);
    object-fit: cover;
    border-radius: 12px;
    background: black;
    display: block;
  }

  .custom-video-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
    border-radius: 12px;
    box-sizing: border-box;
  }

  .custom-mute-button {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 3;
    background: rgba(0, 0, 0, 0.6);
    color: #fff;
    border: none;
    border-radius: 50%;
    padding: 6px 10px;
    font-size: 16px;
    cursor: pointer;
    user-select: none;
  }

  /* Show mute button only on video item */
  .custom-media-item.video-active .custom-mute-button {
    display: block;
  }

  /* Rectangular progress bar around the video */
  .progress-rect {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    pointer-events: none;
    border-radius: 12px;
    box-sizing: border-box;
    border: 4px solid rgba(255, 192, 0, 0.4);
  }

  .progress-bar {
    position: absolute;
    background-color: #f0c040;
    border-radius: 4px;
    transition: width 0.3s linear, height 0.3s linear;
  }

  .progress-top,
  .progress-bottom {
    height: 4px;
    width: 0;
  }
  .progress-top {
    top: 0;
    left: 0;
  }
  .progress-bottom {
    bottom: 0;
    right: 0;
  }

  .progress-left,
  .progress-right {
    width: 4px;
    height: 0;
  }
  .progress-left {
    bottom: 0; /* bottom to top */
    left: 0;
  }
  .progress-right {
    top: 0; /* top to bottom */
    right: 0;
  }

  /* Dots container */
  #custom-carousel-dots {
    margin-top: 15px;
    display: flex;
    justify-content: center;
    gap: 12px;
  }

  #custom-carousel-dots .dot {
    width: 28px;
    height: 28px;
    background: #444;
    border-radius: 50%;
    color: #eee;
    font-size: 16px;
    font-weight: normal;
    text-align: center;
    line-height: 28px;
    cursor: pointer;
    user-select: none;
    transition: all 0.3s ease;
    box-shadow: 0 0 3px rgba(0,0,0,0.4);
  }

  #custom-carousel-dots .dot.active {
    background: #fff;
    color: #000;
    font-weight: bold;
    width: 32px;
    height: 32px;
    font-size: 18px;
    line-height: 32px;
    box-shadow: 0 0 8px #666;
  }
</style>
</head>
<body>

<div id="custom-media-carousel-wrapper">
  <div id="custom-carousel-inner">
    <div class="custom-media-item">
      <img src="img/indy-durga-2021.jpg" alt="Image 1" />
    </div>
    <div class="custom-media-item">
      <img src="img/ns/ns1.jpg" alt="Image 2" />
    </div>
    <div class="custom-media-item">
      <img src="img/ns/ns2.jpg" alt="Image 3" />
    </div>
    <div class="custom-media-item">
      <div class="custom-video-wrapper">
        <video muted preload="metadata" src="img/ns/ns3.mp4"></video>
        <button class="custom-mute-button">ðŸ”‡</button>
        <div class="progress-rect" aria-hidden="true">
          <div class="progress-bar progress-top"></div>
          <div class="progress-bar progress-right"></div>
          <div class="progress-bar progress-bottom"></div>
          <div class="progress-bar progress-left"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="custom-carousel-dots"></div>

<script>
  function initMediaCarousel(width, height, imageDelay) {
    document.documentElement.style.setProperty('--custom-media-width', width + 'px');
    document.documentElement.style.setProperty('--custom-media-height', height + 'px');

    const container = document.getElementById('custom-carousel-inner');
    const items = container.querySelectorAll('.custom-media-item');
    const dotsContainer = document.getElementById('custom-carousel-dots');
    let currentIndex = 0;
    let timeout = null;

    // Create dots with numbers
    dotsContainer.innerHTML = '';
    items.forEach((_, i) => {
      const dot = document.createElement('div');
      dot.className = 'dot';
      dot.textContent = i + 1;
      dot.addEventListener('click', () => {
        clearTimeout(timeout);
        showItem(i);
      });
      dotsContainer.appendChild(dot);
    });
    const dots = dotsContainer.querySelectorAll('.dot');

    function resetProgressBars(progressBars) {
      progressBars.top.style.width = '0';
      progressBars.right.style.height = '0';
      progressBars.bottom.style.width = '0';
      progressBars.left.style.height = '0';
    }

    function updateProgressBars(progressBars, percent) {
      const totalLength = 2 * (width + height - 8);

      let lengthPassed = percent * totalLength;

      if(lengthPassed <= width - 8) {
        progressBars.top.style.width = lengthPassed + 'px';
        resetProgressBarsExcept(progressBars, 'top');
      } else if(lengthPassed <= width - 8 + height - 8) {
        progressBars.top.style.width = (width - 8) + 'px';
        const rightHeight = lengthPassed - (width - 8);
        progressBars.right.style.height = rightHeight + 'px';
        resetProgressBarsExcept(progressBars, 'top', 'right');
      } else if(lengthPassed <= 2 * (width - 8) + height - 8) {
        progressBars.top.style.width = (width - 8) + 'px';
        progressBars.right.style.height = (height - 8) + 'px';
        const bottomWidth = lengthPassed - (width - 8 + height - 8);
        progressBars.bottom.style.width = bottomWidth + 'px';
        resetProgressBarsExcept(progressBars, 'top', 'right', 'bottom');
      } else {
        progressBars.top.style.width = (width - 8) + 'px';
        progressBars.right.style.height = (height - 8) + 'px';
        progressBars.bottom.style.width = (width - 8) + 'px';
        const leftHeight = lengthPassed - (2 * (width - 8) + height - 8);
        progressBars.left.style.height = leftHeight + 'px';
      }
    }

    function resetProgressBarsExcept(progressBars, ...exceptions) {
      if(!exceptions.includes('top')) progressBars.top.style.width = '0';
      if(!exceptions.includes('right')) progressBars.right.style.height = '0';
      if(!exceptions.includes('bottom')) progressBars.bottom.style.width = '0';
      if(!exceptions.includes('left')) progressBars.left.style.height = '0';
    }

    function showItem(index) {
      if (index >= items.length) index = 0;
      currentIndex = index;

      container.style.transform = `translateX(-${index * width}px)`;

      dots.forEach(dot => dot.classList.remove('active'));
      dots[index].classList.add('active');

      items.forEach(item => {
        item.classList.remove('video-active');
        const video = item.querySelector('video');
        if (video) {
          video.pause();
          video.currentTime = 0;
          const progressBars = getProgressBars(item);
          if(progressBars) resetProgressBars(progressBars);
        }
      });

      const currentItem = items[index];
      const media = currentItem.querySelector('img, video');

      if (media.tagName === 'IMG') {
        timeout = setTimeout(() => showItem(index + 1), imageDelay);
      } else if (media.tagName === 'VIDEO') {
        currentItem.classList.add('video-active');
        const progressBars = getProgressBars(currentItem);

        function animateProgress() {
          if(media.duration > 0) {
            const progress = media.currentTime / media.duration;
            updateProgressBars(progressBars, progress);
          }
          if(!media.paused && !media.ended) {
            requestAnimationFrame(animateProgress);
          }
        }

        media.play().then(() => {
          animateProgress();
          media.onended = () => {
            resetProgressBars(progressBars);
            showItem(index + 1);
          };
        }).catch(() => {
          // play error (autoplay restrictions etc)
          showItem(index + 1);
        });
      }
    }

    function getProgressBars(item) {
      const rect = item.querySelector('.progress-rect');
      if (!rect) return null;
      return {
        top: rect.querySelector('.progress-top'),
        right: rect.querySelector('.progress-right'),
        bottom: rect.querySelector('.progress-bottom'),
        left: rect.querySelector('.progress-left'),
      };
    }

    // Mute button toggling
    container.querySelectorAll('.custom-mute-button').forEach(button => {
      button.addEventListener('click', (e) => {
        const video = e.target.closest('.custom-video-wrapper').querySelector('video');
        if(video.muted) {
          video.muted = false;
          e.target.textContent = 'ðŸ”Š';
        } else {
          video.muted = true;
          e.target.textContent = 'ðŸ”‡';
        }
      });
    });

    showItem(0);
  }

  // Initialize the carousel: width, height, image delay(ms)
  initMediaCarousel(400, 300, 4000);
</script>

</body>
</html>
